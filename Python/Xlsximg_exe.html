<!DOCTYPE html>
<html lang="ja">

<head>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Y.W Works｜Python</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="ポートフォリオサイト">
<meta name="keywords" content="VBA,Python,プログラマ,エンジニア,コード">
<link rel="shortcut icon" href="./ico/favicon.ico">
<link rel="apple-touch-icon" href="./ico/apple-touch-icon.png">
<link rel="icon" type="image/png" href="./ico/android-chrome-192x192.png">
<link rel="stylesheet" type="text/css" href="/Works/style.css">
<link rel="stylesheet" href="/Works/prism.css">
<script src="/Works/js/prism.js" defer></script>

</head>


<body>

<div id="container">

<header>

<br/>
<br/>
<h1><a href="/Works/index.html" class="title"><img src="/Works/img/YW_Works.png" alt="Y.W Works" width="60%" height="60%"></a></h1>　ポートフォリオサイト

<div class="content">
<br/>
<br/>
<a href="/Works/index.html" class="menu">HOME</a>
<a href="/Works/VBA.html" class="menu">VBA</a>
<a href="/Works/HTML_CSS.html" class="menu">HTML/CSS</a>
<a href="/Works/Python.html" class="menu">Python</a>
</div>

</header>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y24BD0K2VY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y24BD0K2VY');
</script>

<hr>

<h2>Python</h2>
<p>＞Excel⇒Img変換</p>
<br/>
<br/>

<p>exeファイルにxlsxファイルをドラッグ＆ドロップすると、</p>
<p>Sheet1から使用範囲を取得し、自動的に画像化して保存する機能。</p>
<p>探したものの、1アクションでできるツールが</p>
<p>有りそうで無かったので自作しました。</p>
<br/>
<br/>

<img src="/Works/img/Xlsximg.gif" alt="アイコン">
<br/>
<br/>

<pre>
<code class="language-Python">
import sys
import os
import tkinter
import tkinter.messagebox
import win32com.client as win32
import subprocess
from time import sleep
import pyautogui
from PIL import ImageGrab


#複数のファイルを読み込んだ場合にエラーを返す
if len(sys.argv) != 2:
    tkinter.Tk().withdraw()
    tkinter.messagebox.showwarning(title='エラー', message='単一のファイルで実行してください。')

else:
    #ドラッグしたブックのパスを取得
    filepath = sys.argv[1]

    #ファイル名と拡張子を取得
    filename = os.path.splitext(os.path.basename(filepath))[0]
    ext = os.path.splitext(filepath)[1]

    #拡張子が.xlsx以外はエラーメッセージ表示
    if '.xlsx' != ext:
        tkinter.Tk().withdraw()
        tkinter.messagebox.showwarning(title='エラー', message='このアプリは拡張子が".xlsx"のファイルのみをサポートしています。')

    else:
       #Excelに接続
        xl = win32.Dispatch("Excel.Application")

        #ブックを開く
        wb = xl.Workbooks.Open(filepath)

        #シートを指定
        ws = wb.Worksheets(1)

        #セル範囲を指定
        range = ws.UsedRange

        #指定した範囲をクリップボードにコピー
        range.Copy()

        #ペイントを起動
        subprocess.Popen('mspaint')

        #起動待機
        sleep(1)

        #ペースト⇒コピーで画像取得
        pyautogui.hotkey('ctrl', 'v')
        pyautogui.hotkey('ctrl', 'x')

        #ペイントを閉じる
        pyautogui.hotkey('alt', 'f4')
        pyautogui.hotkey('n')

        #Excelを閉じる
        wb.close

        #クリップボードの内容を取得
        img = ImageGrab.grabclipboard()

        #Excelコピー時に入った左端と上端の1pxの線をトリミング
        img = img.crop((1, 1, img.size[0], img.size[1]))

        #保存フォルダを作成
        if not os.path.exists('img'):
            os.makedirs('img')

        #画像の保存先を指定
        savepath = './img/' + filename + '.png'

        #画像を保存
        img.save(savepath)
</code>
</pre>

<pre>
<code class="language-Python">
#exe化
pyinstaller Xlsximg.py --onefile --noconsole --icon=Xlsximg.ico
</code>
</pre>
  
<footer>
<small>Copyright&copy; Y.Watanabe All Rights Reserved.</small>
</footer>

</div>
<!--/container-->

</body>
</html>
