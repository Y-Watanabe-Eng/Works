<!DOCTYPE html>
<html lang="ja">

<head>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Y.Watanabe</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="ポートフォリオサイト">
<meta name="keywords" content="VBA,Python,プログラマ,エンジニア,コード">
<link rel="shortcut icon" href="./ico/favicon.ico">
<link rel="apple-touch-icon" href="./ico/apple-touch-icon.png">
<link rel="icon" type="image/png" href="./ico/android-chrome-192x192.png">
<link rel="stylesheet" type="text/css" href="/Works/style.css">
<link rel="stylesheet" href="/Works/prism.css">
<script src="/Works/js/prism.js" defer></script>

</head>


<body>

<div id="container">

<header>

<br/>
<br/>
<h1><a href="/Works/index.html" class="title">Y.Watanabe</a></h1>　ポートフォリオサイト

<div class="content">
<br/>
<br/>
<a href="/Works/index.html" class="menu">HOME</a>
<a href="/Works/VBA.html" class="menu">VBA</a>
<a href="/Works/HTML5_CSS3.html" class="menu">HTML5/CSS3</a>
<a href="/Works/Python.html" class="menu">Python</a>
</div>

</header>

<hr>

<h2>Visual Basic</h2>
<h2>for Applications</h2>
<p>＞リストを別ブックへ転記</p>
<br/>
<br/>

<p>元々開いているブックのリストをオートフィルタでソート、</p>
<p>余分な行を除外したリストを別ブックに転記する機能です。</p>
<br/>
<br/>

<pre>
<code class="language-VBA">
Sub ソートしたリストを別ブックに転記()
'ソートしたリストを別ブックに転記

Dim lastRow As String


'年度を取得
Dim fiscalYear

If Month(Date)  <= 3 Then

　fiscalYear = Year(Date) - 1

Else

　fiscalYear = Year(Date) 

End If

'転記元のブックを取得
Dim baseBook As Workbook

Set baseBook = ActiveWorkbook


'転記先のブックを開く
If Month(Date)  <= 9 Then

　Workbooks.Open "¥¥csysuf01¥共有フォルダ¥4_詳細分析¥" & fiscalYear & "年度¥インシデントチェック詳細分析" & Format(DateAdd("m", 0, Date), "yyyy") & "0" & Worksheets(”インシデントチェック集計”).Range("B1") & .xlsx"

Else

　Workbooks.Open "¥¥csysuf01¥共有フォルダ¥4_詳細分析¥" & fiscalYear & "年度¥インシデントチェック詳細分析" & Format(DateAdd("m", 0, Date), "yyyy") & Worksheets(”インシデントチェック集計”).Range("B1") & .xlsx"

Eng If


'転記先のブックを取得
Dim updateBook As Workbook

Set updateBook = ActiveWorkbook


'オートフィルタを解除する
　On Error Resume Next

　　baseBook.Worksheets("インシデントチェック後半").ShowAllData

　On Error GoTo 0


　baseBook.Worksheets("インシデントチェック後半").Range("A1").AutoFilter Field:=8, Criteria1:="修正"
　baseBook.Worksheets("インシデントチェック後半").Range("A1").AutoFilter Field:=10, Criteria1:=""


　lastRow = baseBook.Worksheets("インシデントチェック後半").Cells(Rows.Count, 1).End(xlUp).Row


　baseBook.Worksheets("インシデントチェック後半").Rows("2:" & lastRow).Copy _
　　Dastination:=updateBook.Worksheets("インシデントチェック後半").Rows(2)

　updateBook.Close SaveChanges:=True

End Sub
</code>
</pre>

<footer>
<small>Copyright&copy; Y.Watanabe All Rights Reserved.</small>
</footer>

</div>
<!--/container-->

</body>
</html>

